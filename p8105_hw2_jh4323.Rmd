---
title: "homework2"
author: "Jialiang Hua"
output: github_document
---

```{r library, message = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

Read the Mr. Trash Wheel dataset.

```{r trashwheel_read}
trashwheel_df <- 
  read_excel(
    "./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
    sheet = "Mr. Trash Wheel", 
    range = "A2:N534") %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = round(sports_balls))
```

Read and clean precipitation data for 2018 and 2019

```{r precipitation_read_clean}
precip18_df <-
  read_excel(
    "./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
    sheet = "2018 Precipitation",
    skip = 1) %>%
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018) %>% 
  relocate(year)

precip19_df <-
  read_excel(
    "./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
    sheet = "2019 Precipitation",
    skip = 1) %>%
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2019) %>% 
  relocate(year)
```

Now combine precipitation datasets

```{r combine}
precip_df <-
  bind_rows(precip18_df, precip19_df) %>% 
  mutate(month = month.name[month])
```

The first data set was generated by Mr. Trashwheel trash collector in Baltimore, Maryland. It includes the information of trash entering, collection and dumpster storage. The dataset contains information on `r colnames(trashwheel_df)`. There are a total of `r nrow(trashwheel_df)` rows in the final dataset. 

The second data set was the month precipitation data in 2018 and 2019. The dataset contains information on `r colnames(precip_df)`. There are a total of `r nrow(precip_df)` rows in the final dataset.

* The total precipitation in 2018 was `r precip_df %>% filter(year == 2018) %>% pull(total) %>% sum()` inches.
* The median number of sports balls in a dumpster in 2019 was `r trashwheel_df %>% filter(year == 2019) %>% pull(sports_balls) %>% median()`


## Problem 2

First, clean the data in pols-month.csv

```{r polsmonthdf}
pols_month_df <-
  read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, sep = "-", into = c("year", "month", "day")) %>% 
  mutate(
    year = as.integer(year),
    month = as.integer(month), 
    day = as.integer(day),
    month = month.name[month],
    president = ifelse(prez_gop == 0, "dem", "gop")
  ) %>% 
  select(-day,  -prez_gop, -prez_dem) %>% 
  relocate(year, month, president)
```
    
Second, clean the data in snp.csv

```{r snpdf}
snp_df <- 
  read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = lubridate::mdy(date)) %>% 
  separate(date, into = c("year", "month", "day")) %>% 
  mutate(year = as.integer(year),
         month = as.integer(month),
         day = as.integer(day),
         month = month.name[month]) %>% 
  select(-day) %>% 
  arrange(year, month) %>% 
  relocate(year, month)
```

Third, tidy the unemployment data 

```{r}
unemployment_df <- 
  read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>% 
  pivot_longer(Jan:Dec, 
               names_to = "month", 
               values_to = "unemployment") %>% 
  janitor::clean_names() %>% 
  mutate(month = match(month, month.abb),
         month = month.name[month],
         year = as.integer(year))
```

Join the datasets by merging snp into pols, and merging unemployment into the result

```{r}
pols_snp_unemploy_df <- 
  left_join(pols_month_df, snp_df, by = c("year", "month")) %>% 
  left_join(unemployment_df, by = c("year", "month"))
```

For the pols-months data set, it contains `r nrow(pols_month_df)` observations with `r ncol(pols_month_df)` variables which are respectively `r names(pols_month_df)`. The range of years is from 1947 to 2015.

For the snp data set, it contains `r nrow(snp_df)` observations with `r ncol(snp_df)` variables which are respectively `r names(snp_df)`. The range of years is from 1969 to 2015.

For the unemployment data set, it contains `r nrow(unemployment_df)` observations with `r ncol(unemployment_df)` variables which are respectively `r names(unemployment_df)`. The range of years is from 1948 to 2015.

For the merging data set, it contains `r nrow(pols_snp_unemploy_df)` observations with `r ncol(pols_snp_unemploy_df)` variables which are respectively `r names(pols_snp_unemploy_df)`


##Problem 3

Load and tidy the data

```{r, message=FALSE}
popular_baby_names_df <- read_csv("./data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(
    gender = tolower(gender),
    childs_first_name = tolower(childs_first_name),
    childs_first_name = Hmisc::capitalize(childs_first_name),
    ethnicity = recode(
      ethnicity,
      "ASIAN AND PACI" = "ASIAN AND PACIFIC ISLANDER",
      "BLACK NON HISP" = "BLACK NON HISPANIC",
      "WHITE NON HISP" = "WHITE NON HISPANIC"
    ),
    ethnicity = toupper(ethnicity)
  ) %>% 
  distinct()
```

Produce table showing the rank of female name "Olivia"
```{r}
olivia_df <- 
  filter(popular_baby_names_df, childs_first_name == "Olivia" & gender == "female") %>% 
  select(-count) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) %>% 
  relocate(c(1:3), c(9:4))
olivia_df %>% 
  knitr::kable()
```


Produce a similar table showing the most popular name among male children over time
```{r}
popmale_df <- 
  filter(popular_baby_names_df, gender == "male" & rank == 1) %>% 
  select(-count & -rank) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  ) %>% 
  relocate(1, 2, c(8:3))
popmale_df %>% 
  knitr::kable()
```


Produce a scatter plot
```{r}
# Select the data for plotting
scatterplot_df <- 
  filter(
    popular_baby_names_df, 
    gender == "male" & ethnicity == "WHITE NON HISPANIC" & year_of_birth == 2016)
# Let's plot!!
scatterplot_df %>% 
  ggplot(aes(x = rank, y = count)) + 
  geom_point(alpha = .3) + 
  labs(
    title = "Scatterplot",
    subtitle = "Rank VS. Number of childern",
    x = "Rank of a name",
    y = "Number of children with a name"
  )
```












